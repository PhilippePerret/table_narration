<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/philippeperret/Sites/table_narration/js/App.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/App.html">App</a></li>
            
                <li><a href="../classes/Collection.html">Collection</a></li>
            
                <li><a href="../classes/ColText.html">ColText</a></li>
            
                <li><a href="../classes/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../classes/DICO.html">DICO</a></li>
            
                <li><a href="../classes/Fiche.html">Fiche</a></li>
            
                <li><a href="../classes/FICHES.html">FICHES</a></li>
            
                <li><a href="../classes/FILMS.html">FILMS</a></li>
            
                <li><a href="../classes/Input.UI.Input.html">Input.UI.Input</a></li>
            
                <li><a href="../classes/Mot.html">Mot</a></li>
            
                <li><a href="../classes/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../classes/OBJETS.html">OBJETS</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/App.js.html">App.js</a></li>
            
                <li><a href="../modules/Collection.html">Collection</a></li>
            
                <li><a href="../modules/ColText.html">ColText</a></li>
            
                <li><a href="../modules/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../modules/data.html">data</a></li>
            
                <li><a href="../modules/Data.html">Data</a></li>
            
                <li><a href="../modules/Debug.html">Debug</a></li>
            
                <li><a href="../modules/DICO.html">DICO</a></li>
            
                <li><a href="../modules/DICO.js.html">DICO.js</a></li>
            
                <li><a href="../modules/dom.html">dom</a></li>
            
                <li><a href="../modules/Dom.html">Dom</a></li>
            
                <li><a href="../modules/Edition.html">Edition</a></li>
            
                <li><a href="../modules/FicheClass.html">FicheClass</a></li>
            
                <li><a href="../modules/FICHES.html">FICHES</a></li>
            
                <li><a href="../modules/FilmClass.html">FilmClass</a></li>
            
                <li><a href="../modules/FILMS.html">FILMS</a></li>
            
                <li><a href="../modules/HandyMethods.html">HandyMethods</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/jQueryExtension.html">jQueryExtension</a></li>
            
                <li><a href="../modules/KeyboardEvents.html">KeyboardEvents</a></li>
            
                <li><a href="../modules/KeyEvents.html">KeyEvents</a></li>
            
                <li><a href="../modules/Mot.html">Mot</a></li>
            
                <li><a href="../modules/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../modules/OBJETS.html">OBJETS</a></li>
            
                <li><a href="../modules/ready.js.html">ready.js</a></li>
            
                <li><a href="../modules/String.html">String</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/philippeperret/Sites/table_narration/js/App.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  * @module App.js
  */

/*
 *  Pour empêcher de quitter la page quand des données n&#x27;ont pas été
 *  enregistrées.
 *  
 */
function confirmExit(evt)
{
  if(Collection.modified)
  {
    evt.returnValue = &quot;Veux-tu vraiment quitter ?&quot;
    return &quot;Veux-tu vraiment quitter ?&quot;
  }  
}
window.onbeforeunload = confirmExit

/**
  *	Objet App, pour la gestion de l&#x27;application
  *
  * @class App
  * @static
  *
  */
window.App = {
	
  /**
    * Enregistre la configuration d&#x27;ouverture (et de rangement) actuelle pour
    * la replacer au prochain chargement de l&#x27;application.
    * 
    * NOTES
    * -----
    *
    *   * Envoi la requête Ajax pour créer le fichier &quot;current_config.config&quot;
    *
    * @method save_current_configuration
    * @async
    *
    * @param  forcer  {Boolean} Si TRUE (quand appelé depuis l&#x27;appareil photo),
    *                 on force la destruction du fichier configuration pour prendre
    *                 cette nouvelle configuration.
    * @param  rajax   {Object} Retourn de la requête ajax. Donc indéfini à l&#x27;appel
    *                 de la méthode.
    * 
    */
  save_current_configuration:function(forcer, rajax)
  {
    if(undefined == rajax)
    {
      Ajax.send(
        {script:&#x27;app/save_config&#x27;, config:this.current_config, force:forcer},
        $.proxy(this.save_current_configuration, forcer, this)
      )
    }
    else
    {
      if(rajax.ok) F.show(&quot;Configuration courante enregistrée. Elle sera utilisée au prochain chargement de la table.&quot;)
      else F.error(rajax.message)
    }
  },
  
  // Pour lancer le test de l&#x27;application
  // 
  // @note: la méthode lance aussi un appel à un script ajax 
  // qui va mettre de côté la collection actuelle pour ne pas y 
  // toucher pendant les tests
	test:function()
	{
    window.open(&quot;./tests.php&quot;, &#x27;pure-javascript-test&#x27;)
    Ajax.send({script:&quot;tests/mode_test&quot;}, $.proxy(this.suite_test, this))
	},
  suite_test:function(rajax)
  {
    if(rajax.ok)
    {
      F.show(&quot;Cliquer sur le bouton “-&gt; Mode normal” pour revenir à la collection originale&quot;+
      &quot;\n\nDossier courant : &quot; + rajax.current_folder, {keep:true})
      Collection.load
      $(&#x27;input#btn_test&#x27;).hide()
      $(&#x27;input#btn_collection_originale&#x27;).show()
    }
    else
    {
      F.error(rajax.message)
    }
  },
  
  // Repasser en mode normal (ce qui aura surtout pour effet de remettre le
  // dossier collection courante)
  mode_normal:function()
  {
    Ajax.send({script:&quot;tests/mode_normal&quot;}, $.proxy(this.suite_mode_normal,this))
  },
  suite_mode_normal:function(rajax)
  {
    if(rajax.ok)
    {
      F.show(&quot;Retour au mode normal. Rechargement de la collection en cours.&quot;+
      &quot;\n\nDossier courant : &quot; + rajax.current_folder, {keep:true})
      Collection.load
      $(&#x27;input#btn_test&#x27;).show()
      $(&#x27;input#btn_collection_originale&#x27;).hide()
    }
    else
    {
      F.error(rajax.message)
    }
  },
  
  
  // Jouer &#x27;App.ajax()&#x27; pour voir si le script ajax fonctionne
  ajax:function()
  {
    Ajax.send({
      script:&quot;app/test_ajax&quot;,
      data:{}
    }, $.proxy(this.suite_ajax, this))
  },
  suite_ajax:function(rajax)
  {
    if(rajax.ok) alert(&quot;Tout s&#x27;est bien passé en ajax&quot; +
    &quot;\n\nRuby version: &quot; + rajax.ruby_version)
  }
}

Object.defineProperties(App,{
  
  /**
    * Analyse la configuration actuelle (ouvertures et rangements) et retourne
    * un {Object} à enregistrer dans le fichier de configuration courante.
    *
    * NOTES
    * -----
    *   * Pour procéder, cette propriété/méthode regarde simplement les fiches
    *     qui sont visibles sur la table.
    *
    * @property current_config
    * @return   {Object} Configuration courante, contenant &#x60;visibles&#x27;, les fiches
    *           actuellement visibles (juste pour info) et &#x60;openeds&#x27;, les fiches
    *           actuellement ouvertes (opened = true)
    *
    */
  &quot;current_config&quot;:{
    get:function(){
      var config = {
        openeds   : [],
        visibles  : []
      }
      $(&#x27;section#table &gt; fiche:visible&#x27;).each(function(){
        var fiche = FICHES.domObj_to_fiche($(this))
        var datam = {id:fiche.id, type:fiche.type}
        config.visibles.push(datam)
        if(fiche.opened) config.openeds.push(datam)
      })
      return JSON.stringify(config)
    }
  },
  
  /**
    * Applique la configuration courante. En d&#x27;autres termes, ouvre les fiches qui
    * doivent être ouvertes.
    *
    * @method current_configuration
    *
    */
  &quot;current_configuration&quot;:{
    set:function(conf){
      this._current_configuration = conf
      if(conf == null) return
      var errors = []
      // Juste pour voir, on regarde si les fiches visibles sont bien visibles
      L(conf.visibles).each(function(fdata){
        if($(&#x27;section#table &gt; fiche#f-&#x27;+fdata.id).length == 0) errors.push(&quot;La fiche #&quot;+fdata.id+&quot; devrait être visible.&quot;)
      })
      // On ouvre les fiches qui doivent l&#x27;être
      L(conf.openeds).each(function(fdata){
        if(undefined == FICHES.list[fdata.id]) errors.push(&quot;La fiche #&quot;+fdata.id+&quot; devrait exister…&quot;)
        else get_fiche(fdata.id).open
      })
      if(errors.length)
      {
        Flash.error(&quot;Des erreurs sont survenues en essayant d&#x27;application la configuration courante :\n&quot;+errors.join(&quot;\n\t&quot;))
      }
    }
  }
  
})
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
