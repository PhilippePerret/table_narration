<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/philippeperret/Sites/table_narration/js/ui/ui.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/App.html">App</a></li>
            
                <li><a href="../classes/App.Clipboard.html">App.Clipboard</a></li>
            
                <li><a href="../classes/App.Prefs.html">App.Prefs</a></li>
            
                <li><a href="../classes/Chapter.html">Chapter</a></li>
            
                <li><a href="../classes/Collection.html">Collection</a></li>
            
                <li><a href="../classes/ColText.html">ColText</a></li>
            
                <li><a href="../classes/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../classes/DICO.html">DICO</a></li>
            
                <li><a href="../classes/Fiche.html">Fiche</a></li>
            
                <li><a href="../classes/FICHES.html">FICHES</a></li>
            
                <li><a href="../classes/Film.html">Film</a></li>
            
                <li><a href="../classes/FILMS.html">FILMS</a></li>
            
                <li><a href="../classes/HTMLTable.html">HTMLTable</a></li>
            
                <li><a href="../classes/Mot.html">Mot</a></li>
            
                <li><a href="../classes/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../classes/OBJETS.html">OBJETS</a></li>
            
                <li><a href="../classes/OBJETS.Dom.html">OBJETS.Dom</a></li>
            
                <li><a href="../classes/Page.html">Page</a></li>
            
                <li><a href="../classes/Paragraph.html">Paragraph</a></li>
            
                <li><a href="../classes/PARAGRAPHES.html">PARAGRAPHES</a></li>
            
                <li><a href="../classes/Ref.html">Ref</a></li>
            
                <li><a href="../classes/REFS.html">REFS</a></li>
            
                <li><a href="../classes/Search.html">Search</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/UI.Html.html">UI.Html</a></li>
            
                <li><a href="../classes/UI.Input.html">UI.Input</a></li>
            
                <li><a href="../classes/UI.ModeUnique.html">UI.ModeUnique</a></li>
            
                <li><a href="../classes/UI.Textarea.html">UI.Textarea</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/app.html">app</a></li>
            
                <li><a href="../modules/app

Objet qui gère le clipboard de l&#x27;application, dans lequel on peut mettre
des fiches, des références, etc..html">app

Objet qui gère le clipboard de l&#x27;application, dans lequel on peut mettre
des fiches, des références, etc.</a></li>
            
                <li><a href="../modules/app-prefs.html">app-prefs</a></li>
            
                <li><a href="../modules/App_clipboard.html">App_clipboard</a></li>
            
                <li><a href="../modules/Chapter.html">Chapter</a></li>
            
                <li><a href="../modules/Collection.html">Collection</a></li>
            
                <li><a href="../modules/ColText.html">ColText</a></li>
            
                <li><a href="../modules/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../modules/data.html">data</a></li>
            
                <li><a href="../modules/Data.html">Data</a></li>
            
                <li><a href="../modules/Debug.html">Debug</a></li>
            
                <li><a href="../modules/DICO.html">DICO</a></li>
            
                <li><a href="../modules/DICO.js.html">DICO.js</a></li>
            
                <li><a href="../modules/Dom.html">Dom</a></li>
            
                <li><a href="../modules/dom.html">dom</a></li>
            
                <li><a href="../modules/Edition.html">Edition</a></li>
            
                <li><a href="../modules/edition.collection.js.html">edition.collection.js</a></li>
            
                <li><a href="../modules/Fiche.html">Fiche</a></li>
            
                <li><a href="../modules/fiche_data.html">fiche_data</a></li>
            
                <li><a href="../modules/fiche_dom.html">fiche_dom</a></li>
            
                <li><a href="../modules/FICHES.html">FICHES</a></li>
            
                <li><a href="../modules/FilmClass.html">FilmClass</a></li>
            
                <li><a href="../modules/FILMS.html">FILMS</a></li>
            
                <li><a href="../modules/Html.html">Html</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/jQueryExtension.html">jQueryExtension</a></li>
            
                <li><a href="../modules/KeyboardEvents.html">KeyboardEvents</a></li>
            
                <li><a href="../modules/KeyEvents.html">KeyEvents</a></li>
            
                <li><a href="../modules/Mot.html">Mot</a></li>
            
                <li><a href="../modules/OBJET.html">OBJET</a></li>
            
                <li><a href="../modules/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../modules/objets.html">objets</a></li>
            
                <li><a href="../modules/OBJETS.Dom.html">OBJETS.Dom</a></li>
            
                <li><a href="../modules/Page.html">Page</a></li>
            
                <li><a href="../modules/Paragraph.html">Paragraph</a></li>
            
                <li><a href="../modules/PARAGRAPHS.html">PARAGRAPHS</a></li>
            
                <li><a href="../modules/ready.js.html">ready.js</a></li>
            
                <li><a href="../modules/ref.js.html">ref.js</a></li>
            
                <li><a href="../modules/REFS.js.html">REFS.js</a></li>
            
                <li><a href="../modules/Search.js.html">Search.js</a></li>
            
                <li><a href="../modules/String.html">String</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/UI_HTML.html">UI_HTML</a></li>
            
                <li><a href="../modules/ui_html_table

Le module définit l&#x27;objet UI.Html.str2table et la classe HTMLTable qui
permet de mettre en forme un tableau..html">ui_html_table

Le module définit l&#x27;objet UI.Html.str2table et la classe HTMLTable qui
permet de mettre en forme un tableau.</a></li>
            
                <li><a href="../modules/UI_Input.html">UI_Input</a></li>
            
                <li><a href="../modules/ui_mode_unique.html">ui_mode_unique</a></li>
            
                <li><a href="../modules/window.html">window</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/philippeperret/Sites/table_narration/js/ui/ui.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 *  @module UI
 */

/**
  *  Gestion de l&#x27;interface utilisateur
  *
  *  @class UI
  *  @static
  * 
  */
if(&#x27;undefined&#x27; == typeof UI) UI = {}
$.extend(UI, {
  
  /**
    * data-type pour un champ qui ne peut rester vide
    *
    * @property   {String} FIELD_NOT_EMPTY
    * @static
    * @final
    */
  FIELD_NOT_EMPTY: &#x27;not_empty&#x27;,

  /**
    * data-type pour un champ de type &#x27;horloge&#x27;. La valeur de ce champ
    * sera automatiquement transformée en horloge valide, ou une erreur sera
    * produite si la valeur donnée est incompatible avec une horloge.
    *
    * @property   {String} FIELD_HORLOGE
    * @static
    * @final
    */
  FIELD_HORLOGE: &#x27;horloge&#x27;,

  /**
   *  data-type pour un champ de type nombre.
   *
   *  @property   {String} FIELD_NUMBER
   *  @static
   *  @final
   */
  FIELD_NUMBER:&#x27;number&#x27;,

  /**
   *  data-type pour un champ de type pays (sur deux lettres minuscules).
   *
   *  @property   {String} FIELD_PAYS
   *  @static
   *  @final
   */
  FIELD_PAYS:&#x27;pays&#x27;,
  
  /**
   *  data-type pour un champ de type « people », c&#x27;est-à-dire une liste de personnes.
   *  
   *  NOTES
   *  -----
   *    * Le &#x60;data-format&#x27; du champ doit définir s&#x27;il s&#x27;agit d&#x27;un auteur, d&#x27;un
   *      réalisateur, d&#x27;un acteur, etc.
   *
   *  @property   {String} FIELD_PEOPLE
   *  @static
   *  @final
   */
  FIELD_PEOPLE:&#x27;people&#x27;,
  
  /**
    * LARGEUR d&#x27;un carreau de la grille snap
    * Notes : Correspond à la largeur d&#x27;un livre fermé
    * @property {Number} GRID_X
    * @static
    * @final
    */
  GRID_X    : 250,
  /**
    * HAUTEUR d&#x27;un carreau de la grille snap
    * Notes : Correspond à la hauteur d&#x27;un livre fermé
    * @property {Number} GRID_Y
    * @static
    * @final
    */
  GRID_Y    : 40,
  
  prepared  :false,     // Mis à true quand l&#x27;UI est prête
  preparing :false,     // True pendant la préparation de l&#x27;interface
  
  
  /**
    * Substitut à la méthode &#x60;confirm&#x60; affreuse de Firefox
    *
    * Notes
    * -----
    *   * Si aucune méthode de renoncement n&#x27;est défini (3e paramètres) et que
    *     l&#x27;utilisateur renonce, ça interrompt simplement le processus courant.
    *
    * @method confirm
    * @async
    * @param  {String}    message       Le message de confirmation.
    * @param  {Function}  suivreOk      La méthode qui sera appelée pour suivre si OK
    * @param  {Function}  suivreCancel  (if any) la méthode poursuivre si renoncement.
    * @param  {Object}    options       Optionnellement on peut définir d&#x27;autres valeurs :
    *                                   cancel_name : Nom à donner au bouton Cancel
    *                                   ok_name     : Nom à donner au bouton OK (confirmation)
    *                                   id          : Identifiant à donner à la boite
    */
  confirm:function(message, suivreOk, suivreCancel, options)
  {
    if(undefined == options) options = {}
    Edit.show({
      id      : options.id || &#x27;confirm_&#x27;+Time.now(),
      title   : message,
      buttons : {
        cancel :{name:(options.cancel_name || &quot;Renoncer&quot;), onclick:suivreCancel},
        ok     :{name:(options.ok_name || &quot;OK&quot;), onclick:suivreOk}
      }
    })
  },
  
  /**
    * Aligne les livres sur la grille
    *
    * Notes
    *   * Pour le moment, la méthode n&#x27;est appelée que lorsque la case &quot;Livres rangés&quot;
    *     est cochée (le moment où on le fait) dans les préférences.
    *   * C&#x27;est la position vertical qui l&#x27;emporte. Ensuite, si deux livres sont à
    *     la même hauteur, c&#x27;est la position vertical qui détermine la précédence.
    *   * Cela classe aussi les livres dans Collection.books, pour qu&#x27;ils soient
    *     sélectionnés dans le bon ordre par les flèches
    *
    * @method align_books
    * @param  {String} dir  Orientation de l&#x27;alignement, h:horizontal, v:vertical
    *
    */
  align_books:function(dir)
  {
    if (App.preferences.gridbook == false) return
    
    Collection.sort_book_from_table

    // On les positionne sur la table
    // Rappel : le simple fait de changer left/top appelle le positionnement
    // de la fiche
    var current_x = 0
    var current_y = 0
    var inc_x = App.preferences[&#x27;dirgridbook&#x27;] == &#x27;h&#x27; ? this.GRID_X : 0
    var inc_y = App.preferences[&#x27;dirgridbook&#x27;] == &#x27;v&#x27; ? this.GRID_Y : 0
    L(Collection.books).each(function(book){
      book.modified = current_x != book.left || current_y != book.top
      book.left = current_x
      book.top  = current_y
      current_x += inc_x
      current_y += inc_y
    })
  },
  
  /**
    * Peuple le menu des collections permettant de les choisir
    *
    * Notes
    * -----
    *   * La méthode sélectionne aussi la collection courante, donc elle doit
    *     être appelée après la définition de Collection.name
    *   * Puisque la méthode ne vide pas le select, elle peut être appelée
    *     pour ajouter une collection à la volée, si cette fonctionnalité existe
    *     à l&#x27;avenir.
    *
    * @method peuple_menu_collections
    * @param  {Array} collections   Liste des noms de collections.
    *
    */
  peuple_menu_collections:function(collections)
  {
    var menu = $(&#x27;select#collections&#x27;)
    L(collections).each(function(name){
      menu.append(&#x27;&lt;option name=&quot;&#x27;+name+&#x27;&quot;&gt;&#x27;+name+&#x27;&lt;/option&gt;&#x27;)
    })
    menu.val(Collection.name)
  },
  /**
    * Retourne la position +pos+ sur la grille ou val est [x, y]
    * 
    * @method position_on_grid
    *
    * @param  {Array}   pos       Couple [x, y]
    * @param  {Boolean} snaping   Ne snap la position que si true
    * @return {Object} {left, top}
    *
    */
  position_on_grid:function(pos, snaping){
    if(!snaping) return {left:pos[0], top:pos[1]} ;
    return {
      left: this.position_xy_on_grid(pos[0], this.GRID_X),
      top : this.position_xy_on_grid(pos[1], this.GRID_Y)
    }
  },
  position_xy_on_grid:function(pos, snap)
  {
    prev = pos - pos % snap
    next = snap + prev
    if( Math.abs(pos - prev) &gt; Math.abs(pos - next)) return next
    else return prev
  },
  
  /*
   *  Méthode appelée quand on droppe un outil fiche (card-tool)
   *  sur la table
   *
   *  Cela provoque la création d&#x27;une nouvelle fiche SUR LA TABLE.
   *
   *  NOTES
   *  -----
   *    # Si l&#x27;outil est déplacé sur une autre fiche qui peut être parent,
   *      cette méthode est court-circuitée en mettant drop_on_fiche à true
   *      cf. Fiche.prototype.on_drop
   *
   *    # Noter qu&#x27;il s&#x27;agit d&#x27;un déplacement sur un coin vide de la table, pas
   *      sur une autre fiche.
   *
   *    # Cette méthode étant appelée avant le drop sur un élément
   *      on la retarde à peine.
   *
   *  PARAMS
   *  ------ 
   *  @param  evt   L&#x27;évènement Drop généré (permet de connaitre la position)
   *  @param  ui    Objet ui (ui.helper =&gt; card-tool jQuery) 
   *
   */
  rappelle_ondrop_on_table:function(evt, ui){
    this.ondrop_on_table(evt, ui)
  },
  /**
    * Méthode appelée lorsque l&#x27;on glisse un outil sur la table (principalement
    * pour créer une nouvelle fiche).
    * 
    * Notes
    * -----
    *   * Les deux utilisations principales sont :
    *     * La création d&#x27;une nouvelle fiche (à l&#x27;aide d&#x27;un outil-fiche)
    *     * La sortie d&#x27;une fiche d&#x27;un de ses parents.
    *
    * @method ondrop_on_table
    * @param  {Event}   evt   Drop event
    * @param  {Object}  ui    Set jQuery transmis par droppable.
    */
  ondrop_on_table:function(evt, ui)
  {
    var idm = &quot;UI.ondrop_on_table&quot;
    dlog(&quot;---&gt; &quot;+idm, DB_FCT_ENTER )
    var ctool = ui.helper
    
    // Déterminer la position approximative du drop sur la table
    var pos_table = $(&#x27;section#table&#x27;).position()
    var x = evt.clientX //- pos_table.left  // | Pas tout à fait exact mais
    var y = evt.clientY //- pos_table.top   // | ça n&#x27;importe pas trop
    
    // On crée la fiche
    var ifiche = FICHES.full_create({
      type  : ctool.attr(&#x27;data-type&#x27;),
      left  : x,
      top   : y
    })
    ifiche.positionne
    if(ifiche.is_not_paragraph) ifiche.open
    ifiche.modified = true
    dlog(&quot;&lt;- UI.ondrop_on_table&quot;, DB_FCT_ENTER)
  }
  
})

Object.defineProperties(UI,{
 
  /*
   *  Préparation de l&#x27;interface
   *  --------------------------
   *  Et principalement le placement des observers
   *
   */
  &quot;prepare&quot;:{
    get:function(){
      this.preparing = true
      // La table doit accepter les drops des &quot;card tool&quot; (tous les types)
      $(&#x27;section#table&#x27;).droppable({
        accept  : &#x27;.card_tool&#x27;,
        drop    : $.proxy(this.ondrop_on_table, this)
      })
    
      // Prépation des &quot;card-tools&quot;
      CardTools.prepare
 
 
      this.preparing  = false
      this.prepared   = true
    }
  }
})

/**
  * @class UI.Textarea
  * @static
  */
$.extend(UI, {
  Textarea: {
  
    /**
      * Adapte la taille du textarea en fonction de son contenu
      * @method adapt
      * @param  {DOMElement|jQuerySet} o  L&#x27;élément DOM
      * @usage  UI.Textarea.adapt(&lt;dom element&gt;)
      * @example
      *   UI.Textarea.adapt($(&#x27;div#mon_div&#x27;))
      */
    adapt: function( o ){
      var o     = $(o) ;
      var odom  = o[0] ;
      if ( odom.tagName != &#x27;TEXTAREA&#x27; ) return ;
      var oh    = odom.offsetHeight ;
      if( oh == 0 ) return ; // not displayed
      sh = odom.scrollHeight ;
      if ( oh &gt;= (sh + 10) ) return ;
      o.css( &#x27;height&#x27;, (sh + 20) + &quot;px&quot; ) ;
    }
  }
  
})

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
