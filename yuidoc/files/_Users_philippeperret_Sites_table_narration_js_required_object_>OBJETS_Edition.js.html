<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/philippeperret/Sites/table_narration/js/required/object/&gt;OBJETS_Edition.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/App.html">App</a></li>
            
                <li><a href="../classes/App.Prefs.html">App.Prefs</a></li>
            
                <li><a href="../classes/Chapter.html">Chapter</a></li>
            
                <li><a href="../classes/Collection.html">Collection</a></li>
            
                <li><a href="../classes/ColText.html">ColText</a></li>
            
                <li><a href="../classes/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../classes/DICO.html">DICO</a></li>
            
                <li><a href="../classes/Fiche.html">Fiche</a></li>
            
                <li><a href="../classes/FICHES.html">FICHES</a></li>
            
                <li><a href="../classes/FILMS.html">FILMS</a></li>
            
                <li><a href="../classes/Mot.html">Mot</a></li>
            
                <li><a href="../classes/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../classes/OBJETS.html">OBJETS</a></li>
            
                <li><a href="../classes/OBJETS.Dom.html">OBJETS.Dom</a></li>
            
                <li><a href="../classes/Page.html">Page</a></li>
            
                <li><a href="../classes/Paragraph.html">Paragraph</a></li>
            
                <li><a href="../classes/PARAGRAPHES.html">PARAGRAPHES</a></li>
            
                <li><a href="../classes/Ref.html">Ref</a></li>
            
                <li><a href="../classes/REFS.html">REFS</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/UI.Input.html">UI.Input</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/app.html">app</a></li>
            
                <li><a href="../modules/app-prefs.html">app-prefs</a></li>
            
                <li><a href="../modules/Chapter.html">Chapter</a></li>
            
                <li><a href="../modules/Collection.html">Collection</a></li>
            
                <li><a href="../modules/ColText.html">ColText</a></li>
            
                <li><a href="../modules/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../modules/Data.html">Data</a></li>
            
                <li><a href="../modules/data.html">data</a></li>
            
                <li><a href="../modules/Debug.html">Debug</a></li>
            
                <li><a href="../modules/DICO.html">DICO</a></li>
            
                <li><a href="../modules/DICO.js.html">DICO.js</a></li>
            
                <li><a href="../modules/Dom.html">Dom</a></li>
            
                <li><a href="../modules/dom.html">dom</a></li>
            
                <li><a href="../modules/Edition.html">Edition</a></li>
            
                <li><a href="../modules/edition.collection.js.html">edition.collection.js</a></li>
            
                <li><a href="../modules/Fiche.html">Fiche</a></li>
            
                <li><a href="../modules/fiche_data.html">fiche_data</a></li>
            
                <li><a href="../modules/fiche_dom.html">fiche_dom</a></li>
            
                <li><a href="../modules/FICHES.html">FICHES</a></li>
            
                <li><a href="../modules/FilmClass.html">FilmClass</a></li>
            
                <li><a href="../modules/FILMS.html">FILMS</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/jQueryExtension.html">jQueryExtension</a></li>
            
                <li><a href="../modules/KeyboardEvents.html">KeyboardEvents</a></li>
            
                <li><a href="../modules/KeyEvents.html">KeyEvents</a></li>
            
                <li><a href="../modules/Mot.html">Mot</a></li>
            
                <li><a href="../modules/OBJET.html">OBJET</a></li>
            
                <li><a href="../modules/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../modules/objets.html">objets</a></li>
            
                <li><a href="../modules/OBJETS.Dom.html">OBJETS.Dom</a></li>
            
                <li><a href="../modules/Page.html">Page</a></li>
            
                <li><a href="../modules/Paragraph.html">Paragraph</a></li>
            
                <li><a href="../modules/PARAGRAPHS.html">PARAGRAPHS</a></li>
            
                <li><a href="../modules/ready.js.html">ready.js</a></li>
            
                <li><a href="../modules/ref.js.html">ref.js</a></li>
            
                <li><a href="../modules/REFS.js.html">REFS.js</a></li>
            
                <li><a href="../modules/String.html">String</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/window.html">window</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/philippeperret/Sites/table_narration/js/required/object/&gt;OBJETS_Edition.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  * @module OBJET
  * @submodule Edition
  * @main OBJET
  */ 
OBJETS_Edition = {
 
  /*
   *  Etats
   *  
   */
  form_prepared:false,
  
  /*
   *  Instance du item {Film} en édition (if any)
   *  
   */
  current:null, 
  
  /*
   *  = MAIN = Demande d&#x27;édition du formulaire
   *
   *  @param  id   Identifiant {String} du item à éditer
   *                Si non fourni, c&#x27;est une création.
   */
  edit:function(id)
  {
    if(!this.Dom.panneau_opened) this.Dom.show_panneau()
    if(!this.form_prepared) this.prepare_formulaire
    this.OBJS.Dom.show_formulaire
    if(undefined == id)
    {
      this.init_form
    }
    else
    {
      this.current = this.OBJS.get( id )
      this.current.edit
        // @note: sait gérer le fait que le item ne soit pas encore chargé
    }
  },
  
  /**
    *  Pour enregistrer les modifications (ou créer un nouveau item)
    *
    * NOTES
    * -----
    *   * Si la méthode &#x60;get_values&#x60; rencontre des valeurs invalides, elle renvoie
    *     false ce qui interrompt la procédure de sauvegarde.
    *
    * @method save
    * @return true en cas de succès, false en cas de valeur invalide.
    *
    */
  save:function()
  {
    var values = this.get_values()
    if(values == false /* Donnée invalide */) return false
    var is_new_item = values.id == null
    if(is_new_item)
    {
      var id_new_item = this.id_from_mainprop( values[this.main_prop] )
      this.current = new this.ItemClass( id_new_item )
    }
    else this.current = this.OBJS.get( values.id )
    this.current.dispatch( values )
    if(is_new_item) this.current.id = id_new_item // a été écrasé par dispatch
    // === ENREGISTREMENT DU FILM ===
    this.current.save( 
      $.proxy(this[is_new_item ? &#x27;update_item_list_with_new_item&#x27; : &#x27;end&#x27;], this) 
    )
    return true
  },
  
  /*
   *  Demande de destruction du item d&#x27;identifiant +id+
   *  
   */
  want_remove:function(id)
  {
    Edit.show({
      id:&#x27;destroy_item&#x27;,
      title: LOCALE[this.class_min].ask[&#x27;want delete film&#x27;] + &quot; “&quot;+this.OBJS.get(id).titre+&quot;” ?&quot;,
      buttons:{
        cancel:{name:&quot;Renoncer&quot;},
        ok:{name:LOCALE[this.class_min].label[&#x27;destroy&#x27;], onclick:$.proxy(this.remove, this, id)}
      }
    })
  },
  /*
   *  Destruction du item d&#x27;identifiant +id+
   *  
   */
  remove:function(id)
  {
    Ajax.send({script:this.folder_ajax+&#x27;/destroy&#x27;, item_id:id}, $.proxy(this.suite_remove, this))
  },
  suite_remove:function(rajax)
  {
    if(rajax.ok)
    {
      var item = this.OBJS.get( rajax.item_id )
      this.OBJS.Dom.remove_item(item.id)
      if(this.OBJS.DATA_PER_LETTER[item.let])
      {
        var indice = this.OBJS.DATA_PER_LETTER[item.let].indexOf(item.id)
        console.log(&quot;indice: &quot;+indice)
        this.OBJS.DATA_PER_LETTER[item.let].splice(indice, 1)
      }
      delete this.OBJS.DATA[item.id]
      with(this.OBJS.Dom)
      {
        remove_listing_letter(item.let)
        on_click_onglet(item.let) 
      }
    }
    else F.error(rajax.message)
  },
 
  
   
  /*
   *  Appelé après &#x60;save&#x27; ci-dessus en cas de nouveau film
   *  On doit actualiser la liste des films (pour ne pas avoir à la recharger)
   *  et rafraichir l&#x27;affichage de la liste si nécessaire (si elle est affichée ou
   *  construite, entendu que la lettre affichée n&#x27;est pas forcément la lettre du
   *  film)
   *  
   *  @requis   this.current    Instance {Film} du nouveau film
   */
  update_item_list_with_new_item:function()
  {
    var uitem = this.current
    uitem.is_new = true // encore utile ?
    // = Ajout à this.OBJS.DATA =
    this.OBJS.DATA[uitem.id] = uitem.data_mini
    // = Ajout à this.OBJS.DATA_PER_LETTER =
    // @note: si DATA_PER_LETTER a déjà été établie, c&#x27;est ici
    // qu&#x27;il faut ajouter le uitem. Sinon, il sera automatiquement
    // ajouté à la définition de DATA_PER_LETTER.
    if(this.OBJS.check_if_list_per_letter_ok)
    {
      this.OBJS.DATA_PER_LETTER[uitem.let].push( uitem.id )
      this.OBJS.DATA_PER_LETTER[uitem.let].sort
    } 
    // = Forcer l&#x27;actualisation du listing =
    this.OBJS.Dom.remove_listing_letter( uitem.let )
    // = Finir et afficher le listing =
    this.end()
  },
  
  /*
   *  Pour terminer l&#x27;édition/création du film
   *
   *  NOTES
   *  -----
   *    = Cette méthode est appelée directement par le bouton &quot;Renoncer&quot;, sans
   *      passer par &#x60;save&#x27; ci-dessus
   *  
   *    = On peut venir aussi de &#x60;update_item_list_with_new_item&#x27; ci-dessus lorsque
   *      c&#x27;est une création de film.
   */
  end:function()
  {
    this.OBJS.Dom.hide_formulaire
    if(this.current &amp;&amp; this.current.is_new) this.OBJS.Dom.on_click_onglet( this.current.let )
  },
 
  /*
   *  Retourne un identifiant de film à partir du +value+ fourni
   *  
   *  TODO: Voir si ce sera pareil pour les mots… En tout cas, il faut
   *        également commencer par le mot  lui-même pour les classements 
   *        et les tris par lettre.
   *
   */
  id_from_mainprop:function(value)
  {
    var t = Texte.to_ascii( value )
    t = t.titleize().replace(/[^a-zA-Z0-9]/g,&#x27;&#x27;)
    return t
  },
 
}


/*
 *  Propriétés complexes à ajouter aux sous-objets &lt;OBJETS PLURIEL&gt;.Edition
 *  
 */
OBJETS_Edition_defined_properties = {
  
  /*
   *  Raccourci pour obtenir &lt;parent&gt;.Dom (et pouvoir donc utiliser &#x60;this.Dom...&#x27;)
   *  
   */
  &quot;Dom&quot;:{get:function(){return this.OBJS.Dom}},
  /*
   *  Raccourci pour obtenir l&#x27;identifiant du panneau
   *  
   */
  &quot;id_panneau&quot;:{
    get:function(){
      if(undefined == this._id_panneau)
      {
        this._id_panneau = this.OBJS.Dom.id_panneau
      }
      return this._id_panneau
    }
  },
  /*
   *  Raccourci pour obtenir le préfix utilisé par &lt;OBJET PLURIEL&gt;.Dom
   *  
   */
  &quot;prefix&quot;:{
    get:function(){
      if(undefined == this._prefix) this._prefix = this.OBJS.Dom.prefix
      return this._prefix
    }
  },
  
  /*
   *  Return le {jQuerySet} du formulaire d&#x27;édition du film.
   *  
   */
  &quot;form&quot;:{
    get:function(){return $(&#x27;div#&#x27;+this.id_panneau+&#x27;_edition div#&#x27;+this.prefix+&#x27;form&#x27;)}
  },
  
  
  /*
   *  Préparation du formulaire
   *  
   *  NOTES
   *  -----
   *    = Il est préparé masqué
   *    = On place sur tous les champs de saisie textuels le gestionnaire
   *      de focus et blur de UI.Input
   */
  &quot;prepare_formulaire&quot;:{
    get:function(){
      $(&#x27;div#&#x27;+this.id_panneau+&#x27;_edition&#x27;).html(&#x27;&#x27;)
      $(&#x27;div#&#x27;+this.id_panneau+&#x27;_edition&#x27;).append( this.html_form )
      UI.Input.bind( this.form )
      this.form_prepared = true
    }
  },

  /*
   *  Retourne le code HTML du formulaire
   *  
   */
  &quot;html_form&quot;:{
    get:function(){
      return  &#x27;&lt;div id=&quot;&#x27;+this.prefix+&#x27;div_form&quot; class=&quot;div_form_item&quot;&gt;&#x27; +
                this.html_formulaire + 
                this.html_div_buttons + 
              &#x27;&lt;/div&gt;&#x27;
    }
  },





  /*
   *  Construit un champ d&#x27;après les données dfield
   *  
   */
  &quot;html_field&quot;:{
    value:function(dfield){
      if(&#x27;string&#x27;==typeof dfield) return dfield
      var field = &quot;&quot;
      var type  = dfield.type || &#x27;text&#x27;
      if(dfield.id) dfield.id = this.class_min+&#x27;Edit-&#x27;+dfield.id
      switch(type)
      {
      case &#x27;text&#x27;:
        if(dfield.label) field += &#x27;&lt;label class=&quot;libelle&quot; for=&quot;&#x27;+dfield.id+&#x27;&quot;&gt;&#x27;+dfield.label+&#x27;&lt;/label&gt;&#x27;
        return field + this.html_balise_in_field(dfield)
      case &#x27;textarea&#x27;:
        if(dfield.label) field += &#x27;&lt;label class=&quot;libelle&quot; for=&quot;&#x27;+dfield.id+&#x27;&quot;&gt;&#x27;+dfield.label+&#x27;&lt;/label&gt;&#x27;
        var value = dfield.value; delete dfield.value
        if(dfield.class) dfield.class = dfield.class.split(&#x27; &#x27;)
        else dfield.class = []
        dfield.class.push(&#x27;returnable&#x27;)
        dfield.class = dfield.class.join(&#x27; &#x27;)
        return field + this.html_balise_in_field(dfield) + (value ? value : &quot;&quot;) + &#x27;&lt;/textarea&gt;&#x27;
      case &#x27;hidden&#x27;:
        return &#x27;&lt;input type=&quot;hidden&quot; id=&quot;&#x27;+dfield.id+&#x27;&quot; value=&quot;&quot; /&gt;&#x27;
      }
    }
  },
  
  /*
   *  Retourne le code HTML des attributs du champ d&#x27;après ses données +dfield+
   *  
   */
  &quot;html_balise_in_field&quot;:{
    value:function(dfield)
    {
      if(undefined == dfield.type) dfield.type = &#x27;text&#x27;
      return &quot;&lt;&quot; + (dfield.type == &#x27;text&#x27; ? &#x27;input&#x27; : dfield.type) +
      (dfield.type==&#x27;text&#x27;? &#x27; type=&quot;text&quot;&#x27; :  &#x27;&#x27;) +
      (dfield.id          ? &#x27; id=&quot;&#x27;           +dfield.id          +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.class       ? &#x27; class=&quot;&#x27;        +dfield.class       +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.data_type   ? &#x27; data-type=&quot;&#x27;    +dfield.data_type   +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.data_format ? &#x27; data-format=&quot;&#x27;  +dfield.data_format +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.value       ? &#x27; value=&quot;&#x27;        +dfield.value       +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.style       ? &#x27; style=&quot;&#x27;        +dfield.style       +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.title       ? &#x27; title=&quot;&#x27;        +dfield.title       +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.alt         ? &#x27; alt=&quot;&#x27;          +dfield.alt         +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.placeholder ? &#x27; placeholder=&quot;&#x27;  +dfield.placeholder +&#x27;&quot;&#x27; : &#x27;&#x27;) +
      (dfield.type==&#x27;text&#x27; ? &#x27; /&gt;&#x27; : &#x27;&gt;&#x27;)
    }
  },
    
  /*
   *  Code HTML des boutons du formulaire
   *  
   */
  &quot;html_div_buttons&quot;:{
    get:function(){
      dlog(&quot;-&gt; &quot;+this.NAME+&quot;.html_div_buttons&quot;, DB_FCT_ENTER)
      return  &#x27;&lt;div class=&quot;buttons&quot;&gt;&#x27; +
                &#x27;&lt;input type=&quot;button&quot; value=&quot;Renoncer&quot; onclick=&quot;$.proxy(&#x27;+this.NAME+&#x27;.end, &#x27;+this.NAME+&#x27;)()&quot; class=&quot;fleft&quot; /&gt;&#x27; +
                &#x27;&lt;input type=&quot;button&quot; value=&quot;Enregistrer&quot; onclick=&quot;$.proxy(&#x27;+this.NAME+&#x27;.save, &#x27;+this.NAME+&#x27;)()&quot; /&gt;&#x27; +
              &#x27;&lt;/div&gt;&#x27;
    }
  }
  
}

// Extensions pour les films
if(undefined == FILMS.Edition) FILMS.Edition = {}
$.extend(FILMS.Edition, OBJETS_Edition)
Object.defineProperties(FILMS.Edition, OBJETS_Edition_defined_properties)
// Extensions pour le Scénodico
if(undefined == DICO.Edition) DICO.Edition = {}
$.extend(DICO.Edition, OBJETS_Edition)
Object.defineProperties(DICO.Edition, OBJETS_Edition_defined_properties)


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
