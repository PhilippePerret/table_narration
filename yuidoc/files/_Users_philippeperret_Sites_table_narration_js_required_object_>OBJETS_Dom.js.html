<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/philippeperret/Sites/table_narration/js/required/object/&gt;OBJETS_Dom.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/App.html">App</a></li>
            
                <li><a href="../classes/Chapter.html">Chapter</a></li>
            
                <li><a href="../classes/Collection.html">Collection</a></li>
            
                <li><a href="../classes/ColText.html">ColText</a></li>
            
                <li><a href="../classes/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../classes/DICO.html">DICO</a></li>
            
                <li><a href="../classes/Fiche.html">Fiche</a></li>
            
                <li><a href="../classes/FICHES.html">FICHES</a></li>
            
                <li><a href="../classes/FILMS.html">FILMS</a></li>
            
                <li><a href="../classes/Mot.html">Mot</a></li>
            
                <li><a href="../classes/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../classes/OBJETS.html">OBJETS</a></li>
            
                <li><a href="../classes/OBJETS.Dom.html">OBJETS.Dom</a></li>
            
                <li><a href="../classes/Page.html">Page</a></li>
            
                <li><a href="../classes/Paragraph.html">Paragraph</a></li>
            
                <li><a href="../classes/PARAGRAPHES.html">PARAGRAPHES</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/UI.Input.html">UI.Input</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/App.js.html">App.js</a></li>
            
                <li><a href="../modules/Chapter.html">Chapter</a></li>
            
                <li><a href="../modules/Collection.html">Collection</a></li>
            
                <li><a href="../modules/ColText.html">ColText</a></li>
            
                <li><a href="../modules/ContextualHelp.html">ContextualHelp</a></li>
            
                <li><a href="../modules/data.html">data</a></li>
            
                <li><a href="../modules/Data.html">Data</a></li>
            
                <li><a href="../modules/Debug.html">Debug</a></li>
            
                <li><a href="../modules/DICO.html">DICO</a></li>
            
                <li><a href="../modules/DICO.js.html">DICO.js</a></li>
            
                <li><a href="../modules/Dom.html">Dom</a></li>
            
                <li><a href="../modules/dom.html">dom</a></li>
            
                <li><a href="../modules/Edition.html">Edition</a></li>
            
                <li><a href="../modules/Fiche.html">Fiche</a></li>
            
                <li><a href="../modules/fiche_data.html">fiche_data</a></li>
            
                <li><a href="../modules/fiche_dom.html">fiche_dom</a></li>
            
                <li><a href="../modules/FICHES.html">FICHES</a></li>
            
                <li><a href="../modules/FilmClass.html">FilmClass</a></li>
            
                <li><a href="../modules/FILMS.html">FILMS</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/jQueryExtension.html">jQueryExtension</a></li>
            
                <li><a href="../modules/KeyboardEvents.html">KeyboardEvents</a></li>
            
                <li><a href="../modules/KeyEvents.html">KeyEvents</a></li>
            
                <li><a href="../modules/Mot.html">Mot</a></li>
            
                <li><a href="../modules/OBJET.html">OBJET</a></li>
            
                <li><a href="../modules/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../modules/objets.html">objets</a></li>
            
                <li><a href="../modules/OBJETS.Dom.html">OBJETS.Dom</a></li>
            
                <li><a href="../modules/Page.html">Page</a></li>
            
                <li><a href="../modules/Paragraph.html">Paragraph</a></li>
            
                <li><a href="../modules/PARAGRAPHS.html">PARAGRAPHS</a></li>
            
                <li><a href="../modules/ready.js.html">ready.js</a></li>
            
                <li><a href="../modules/String.html">String</a></li>
            
                <li><a href="../modules/UI.html">UI</a></li>
            
                <li><a href="../modules/window.html">window</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/philippeperret/Sites/table_narration/js/required/object/&gt;OBJETS_Dom.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  * @module OBJETS.Dom
  * @submodule Dom
  * @main objets
  */

OBJETS.Dom = {
  /**
    * Constante définissant les raccourcis classiques
    * @deprecated Préférer les objets de ContextualHelp.
    * @property SHORTCUTS_COMMUNS
    * @static
    * @for OBJETS.Dom
    */
  SHORTCUTS_COMMUNS:
    image(&#x27;clavier/K_Entree.png&#x27;) + &quot; Balise, &quot; +
    image(&#x27;clavier/K_Escape.png&#x27;) + &quot; Fermer, &quot; +
    image(&#x27;clavier/K_Tab.png&#x27;) + &quot; Section suivante.&quot; ,
    
  /**
    * Données pour les trois focus possibles dans le panneau. Celui sur la
    * bande l&#x27;onglet, celui sur le listing et celui sur les options d&#x27;affichage.
    *  
    * PROPERTIES
    * ----------
    *   * id      {String} Identifiant du focus
    *   * next    {String} Identifiant du prochain focus si TAB est utilisé
    *   * prev    {String} Focus précédent avec TAB
    *   * obj     {jQuery Set} de l&#x27;élément DOM sur lequel placer le focus
    *   * help    {String} Message d&#x27;aide à afficher.
    *
    * @property DFOCUS
    * @type {Object}
    * @static
    * @for OBJETS.Dom
    */
  DFOCUS: {
    &#x27;onglets&#x27;:{id:&#x27;onglets&#x27;, prev:&#x27;options&#x27;, next:&#x27;listing&#x27;, obj:null, 
    help:
      &quot;Presser la touche de la lettre pour changer d&#x27;onglet.&quot;
    },
    &#x27;listing&#x27;:{id:&#x27;listing&#x27;, prev:&#x27;onglets&#x27;, next:&#x27;options&#x27;, obj:null, 
    help:
      image(&#x27;clavier/K_Command.png&#x27;) + image(&#x27;clavier/CLICK.png&#x27;) + 
      &quot;/&quot; + image(&#x27;clavier/CLICK.png&#x27;) + image(&#x27;clavier/K_Entree.png&#x27;) + &quot; Balise, &quot; +
      image(&#x27;clavier/K_FlecheH.png&#x27;) + image(&#x27;clavier/K_FlecheB.png&#x27;) + &quot; Suivant/précédent, &quot; +
      image(&#x27;clavier/K_Command.png&#x27;) + &quot; + LETTRE =&gt; Listing, &quot; +
      image(&#x27;clavier/K_E.png&#x27;) + &quot; Éditer, &quot; + 
      image(&#x27;clavier/K_Effacer.png&#x27;) + &quot; Détruire, &quot;
    },
    &#x27;options&#x27;:{id:&#x27;options&#x27;, prev:&#x27;listing&#x27;, next:&#x27;onglets&#x27;, obj:null, help:null}
  },

  
  /*
   *  Focus courant {Hash}
   *  --------------------
   *  
   *  Le {Hash} dans this.DFOCUS qui détermine sur quoi focus actuellement
   *  le panneau. Peut-être la ligne d&#x27;onglets, le listing ou les options.
   *
   *  NOTES
   *  -----
   *    = À l&#x27;ouverture du panneau, le focus est toujours placé sur la
   *      barre d&#x27;onglets.
   *    = Le focus courant détermine le sens des raccourcis clavier
   *
   */
  current_focus:null,
  
  /*
   *  Indique que la fenêtre est construite
   *  
   */
  main_panneau_ready: false,
  
  /*
   *  Les Options {Hash} envoyées à la méthode choose_an_item
   *  
   */
  options:null,

 
  /*
   *  Lettre courante (affichée)
   *  
   *  NOTES
   *  -----
   *    ::  Partout où je parle de « lettre » ci-dessous, il s&#x27;agit en vérité
   *        de la valeur ASCII de la lettre, sauf pour les chiffres qui sont
   *        tous représentés par 0.
   *    ::  Dans la table FILMS.DATA, c&#x27;est la propriété &#x60;let&#x27; qui contient cette
   *        valeur.
   */
  current_letter: null,
  
  /**
    * Ouvre le panneau des films
    *
    * @method show_panneau
    * @for OBJETS.Dom
    */
  show_panneau:function()
  {
    // Pas de sauvegarde pendant l&#x27;édition des films
    Collection.disable_save
    
    if(false == this.main_panneau_ready) this.prepare_panneau
    else this.panneau.show()
        
    // Mémoriser le champ courant s&#x27;il existe
    this.current_textfield = UI.Input.memorize_current({blur:true})

    // Pour le moment :
    this.old_window_onkeypress = window.onkeypress
    window.onkeypress = null
    
    this.set_focus_on(&#x27;onglets&#x27;)
  },
  
  /*
   *  Ferme le panneau des items
   *  
   *  NOTES
   *  -----
   *    = Relance la boucle de sauvegarde si on est en enregistrement
   *      automatique.
   */
  hide_panneau:function()
  {
    this.panneau.hide()
    if(this.current_textfield)
    {
      UI.Input.retreive_current(this.current_textfield, {focus:true})
    }
    window.onkeypress = this.old_window_onkeypress
    Collection.enable_save
    help(&#x27;&#x27;)
  },
  
  /*
   *  Reçoit le div principal de l&#x27;item +obj+ (DIV principal) et
   *  retourne l&#x27;identifiant de l&#x27;item
   *
   *  NOTES
   *  -----
   *    = Pour fonctionner, la convention est que l&#x27;identifiant de 
   *      l&#x27;élément se trouve toujours en seconde position dans l&#x27;identifiant
   *      du DOM Element, quand on le split avec de &quot;-&quot;
   *      I.e. : &lt;balise&gt;-&lt;IDENTIFIANT&gt;[-&lt;autres valeurs&gt;]
   *
   *  @param  obj   Un {jQuery Set} ou un {DOM Element}  
   */
  idOf:function(obj)
  {
    return $(obj)[0].id.split(&#x27;-&#x27;)[1]
  },
  
  /*
   *  Met le focus sur un élément du panneau (onglets, listing ou options)
   *  
   *  @param  idfocus   Clé {String} dans this.DFOCUS
   */
  set_focus_on:function(idfocus)
  {
    dlog(&quot;-&gt; &quot;+this.NAME+&quot;.set_focus_on(&#x27;&quot;+idfocus+&quot;&#x27;)&quot;, DB_FCT_ENTER)
    if(this.current_focus) this.current_focus.obj.removeClass(&#x27;focused&#x27;)
    this.current_focus = this.DFOCUS[idfocus]
    // dlog(&quot;idfocus:&quot;+idfocus)
    // dlog(&quot;this.DFOCUS[idfocus]:&quot;)
    // dlog(this.DFOCUS[idfocus])
    this.current_focus.obj.addClass(&#x27;focused&#x27;)
    this.current_focus.obj[0].focus()
    F.clean()
    if(this.DFOCUS[idfocus].help)
    {
      help(this.DFOCUS[idfocus].help +&#x27;, &#x27;+this.SHORTCUTS_COMMUNS)
    } 
  },
  
  // /*
  //  *  Active le gestion keypress pour le focus +idfocus+ {String}
  //  *  
  //  */
  // active_keypress_on:function(idfocus)
  // {
  //   
  // },

  keypress_on_onglets:function(evt)
  {
    dlog(&quot;-&gt; &quot;+this.NAME+&quot;.keypress_on_onglets&quot;, DB_FCT_ENTER)
    if( this.keypress_common(evt) ) return stop_event(evt)
    switch(evt.keyCode)
    {
    }
    var ccode = evt.charCode
    if(ccode.is_between(97, 122))
    {
      this.on_click_onglet(ccode - 32)
    }
    return stop_event(evt)
  },
  keypress_on_listing:function(evt)
  {
    dlog(&quot;-&gt; &quot;+this.NAME+&quot;.keypress_on_listing&quot;, DB_FCT_ENTER)
    if( this.keypress_common(evt) ) return stop_event(evt)
    var complex_method = null
    switch(evt.keyCode)
    {
    case K_UP_ARROW:    complex_method = &#x27;select_prev_item&#x27;   ; break
    case K_DOWN_ARROW:  complex_method = &#x27;select_next_item&#x27;   ; break
    case K_ERASE:       complex_method = &#x27;remove_selected&#x27;    ; break
    // Note : La touche RETURN est traité dans keypress_common
    }
    if(complex_method)
    {
      this[complex_method]
      return stop_event(evt)
    }
    /*
     *  Dans le listing, le raccourci CMD + Lettre permet de 
     *  changer d&#x27;onglet.
     *  
     */
    var ccode = evt.charCode
    if(evt.metaKey)
    {
      if(ccode.is_between(97, 122))
      {
        this.on_click_onglet(ccode - 32)
      }
      return stop_event(evt)
    }
    else
    {
      switch(ccode)
      {
      case Key_e: this.edit_selected; break
      }
    }
    
  },

  /*
   *  Keypress commun à tous les focus
   *  
   */
  keypress_common:function(evt)
  {
    stop_event(evt)
    switch(evt.keyCode)
    {
    case K_RETURN:
      // Quel que soit le focus, la touche retour choisit l&#x27;item courant
      this.choose_current_item
      return true
    case K_TAB:
      this.set_focus_on( this.current_focus[evt.shiftKey ? &#x27;prev&#x27; : &#x27;next&#x27;] )
      return true
    case K_ESCAPE:
      this.hide_panneau()
      return true
    }
    switch(evt.charCode)
    {
    case Key_n: // =&gt; Nouveau film
      if(this.current_focus.id != &#x27;listing&#x27; &amp;&amp; evt.metaKey)
      {
        this.OBJS.Edition.edit()
        stop_event(evt)
        return true
      }
    }
    return false // la touche n&#x27;a pas été traitée ici
  },
  
  
  /*
   *  Méthode appelée quand on clique sur un onglet du panneau des films
   *
   *  NOTES
   *  -----
   *    ::  Si la liste des films de la lettre voulue n&#x27;est pas encore établie
   *        on la construit.
   *  
   *    ::  La méthode est appelée aussi après l&#x27;insertion d&#x27;un nouveau film
   *        pour forcer l&#x27;actualisation du panneau.
   *
   */
  on_click_onglet:function(letter)
  {
    if(this.current_letter) this.hide_listing(this.current_letter)
    $(&#x27;div#&#x27;+this.prefix+&#x27;onglet_letter-&#x27;+letter).addClass(&#x27;pressed&#x27;)
    // dlog(&quot;on_click_onglet dans &quot;+this.NAME+&quot; avec lettre &quot;+letter)
    if(!this.letters_built[letter]) this.build_listing( letter )
    else this.show_listing(letter)
    this.set_focus_on(&#x27;listing&#x27;)
  },
  
  /*
   *  Quand on change une options d&#x27;affichage
   *  
   */
  onchange_option:function(obj)
  {
    var option = obj.id.split(&#x27;-&#x27;)[1]
    this.options_balise[option] = obj.checked
    this.set_apercu_balise
  },
  
  /*
   *  Affiche le listing de films de la lettre +letter+
   *  
   */
  show_listing:function(letter)
  {
    this.current_item = null
    this.current_letter  = letter
    $(this.jid_current_listing).show()
  },
  /*
   *  Masque le listing de films de la lettre +letter+
   *  
   */
  hide_listing:function(letter)
  {
    $(this.jid_current_listing).hide()
    $(&#x27;div#&#x27;+this.prefix+&#x27;onglet_letter-&#x27;+letter).removeClass(&#x27;pressed&#x27;)
    this.current_letter  = null
    this.current_item     = null
  },
  
  /*
   *  Construit le listing de la lettre +letter+ (qui sera mise en courante)
   *  
   */
  build_listing:function(letter)
  {
    this.div_listing.append(this.html_listing(letter))
    dlog(&quot;build_listing dans &quot;+this.NAME)
    this.letters_built[letter] = true
    this.current_letter = letter
  },
  
  /*
   *  Détruit le listing d&#x27;une lettre (pour rafraîchissement)
   *  
   */
  remove_listing_letter:function(letter)
  {    
    if(!this.letters_built[letter]) return // rien à faire
    if(this.current_letter == letter) this.current_letter = null
    delete this.letters_built[letter]
    $(&#x27;div#&#x27;+this.listing_id(letter)).remove()
    this.current_item = null
  },
  
  /*
   *  Méthode appelée quand on clique sur un film
   *
   *  NOTES
   *  -----
   *    = Si la touche CMD est pressée, on écrit directement la balise
   *      dans le texte édité.  
   */
  on_select_item:function(id, evt)
  {
    this.current_item = id
    if(evt.metaKey) this.OBJS.on_choose_item(id)
    else
    {
      this.set_focus_on(&#x27;listing&#x27;)
    }
  },
  
  /*
   *  Détruit le DOMElement du film d&#x27;identifiant +fid+
   *  s&#x27;il est construit
   *
   */
  remove_item:function(id)
  {
    $(&#x27;div#&#x27;+this.id_div_item(id)).remove()
  },
 

  /*
   *  Retourne le code HTML du listing de la lettre +letter+
   *  C&#x27;est un DIV contenant tous les items de cette lettre
   *  
   */
  html_listing:function(letter){
    var fdata, c = &quot;&quot;, letter_list, i = 0, items_count ;
    this.OBJS.check_if_list_per_letter_ok
    letter_list = this.OBJS.DATA_PER_LETTER[letter]
    items_count = letter_list.length
    for(; i&lt;items_count; ++i) 
    {
      /*
       *  AJOUT DU DIV DU FILM
       *  
       */
      c += this.html_div_item(this.OBJS.DATA[letter_list[i]])
    }
    return &#x27;&lt;div id=&quot;&#x27;+this.listing_id(letter)+&#x27;&quot; class=&quot;listing_films&quot;&gt;&#x27; + c + &#x27;&lt;/div&gt;&#x27;
  },
  
  /* Retourne l&#x27;identifiant DOM du div principal d&#x27;un item de la liste (un film) */
  id_div_item:function(item_id){ return this.prefix+&quot;div_item-&quot;+item_id },

  /* 
   * Retourne le {jQuery Set} du div principal d&#x27;un item de la liste 
   *
   */
  div_item:function(item_id)
  {
    return $(&#x27;div#&#x27; + this.id_div_item(item_id))
  },

  /* Retourne l&#x27;identifiant du listing (DIV) pour la lettre +letter+ */
  listing_id:function(letter){
    return &quot;panneau_&quot;+this.prefix+&quot;listing-&quot;+letter
  }
  
}

/*
 *  Propriétés complexes à ajouter aux sous-objets &lt;OBJETS PLURIEL&gt;.Dom
 *  
 */
OBJETS_Dom_defined_properties = {
  /*
   *  STATES
   *  
   */
  &quot;panneau_opened&quot;:{
    get:function(){
      return $(this.jid_panneau).length &gt; 0
    }
  },
  /* ---------------------------------------------------------------------
   *
   *  ÉLÉMENTS DOM
   *
   */
  /* Le panneau complet */
  &quot;id_panneau&quot;:{get:function(){ return this.prefix+&quot;panneau&quot; }},
  &quot;jid_panneau&quot;:{get:function(){ return &quot;panneau#&quot;+this.id_panneau}},
  &quot;panneau&quot;:{
    get:function(){ return $(this.jid_panneau)}
  },
  
  /* Le DIV de la barre d&#x27;onglets */
  &quot;div_onglets&quot;:{
    get:function(){ return $(this.jid_panneau + &#x27; &gt; div#&#x27;+this.id_panneau+&#x27;_onglets&#x27;)}
  },
  /* Le DIV contenant tous les listings par lettre */
  &quot;div_listing&quot;:{
    get:function(){ return $(this.jid_panneau + &#x27; &gt; div#&#x27;+this.id_panneau+&#x27;_listings&#x27;)}
  },
  /* Le DIV des options de balise */
  &quot;div_options&quot;:{
    get:function(){ return $(this.jid_panneau + &#x27; &gt; div#&#x27;+this.id_panneau+&#x27;_options&#x27;)}
  },
  /*
   *  Retourne le DIV du listing courant ({jQuery Set})
   *  
   */
  &quot;div_current_listing&quot;:{
    get:function(){
      return $(this.jid_current_listing)
    }
  },
  /* Retourne le jID du listing de la lettre courante */
  &quot;jid_current_listing&quot;:{
    get:function(){ return &quot;div#&quot;+this.listing_id(this.current_letter)}
  },
  
  /*
   *  Retourne le {jQuery Set} du DIV principal de l&#x27;élément sélectionné
   *  
   */
  &quot;div_current_item&quot;:{
    get:function(){ return this.div_item(this.current_item) }
  },
 
  
  /* ---------------------------------------------------------------------
   *  MÉTHODES
   --------------------------------------------------------------------- */
  
  /*
   *  Retourne ou définit l&#x27;IDENTIFIANT de l&#x27;item courant
   *
   *  Lors de la définition (this.current_item = ID), la méthode désactive
   *  l&#x27;item courant s&#x27;il existe et applique le style selected au nouvel
   *  item courant.
   *  
   */
  &quot;current_item&quot;:{
    get:function(){return this._current_item || null},
    /*
     *  Définition de l&#x27;item courant
     *
     *  @param  cur   Identifiant de l&#x27;item (?)
     */
    set:function(cur){
      if(this.current_item) this.div_item(this.current_item).removeClass(&#x27;selected&#x27;)
      if(cur) // car la méthode peut être appelée pour déselectionner le courant
      {
        this.div_item(cur).addClass(&#x27;selected&#x27;)
        this.scroll_to_current_item
        this.set_apercu_balise
      }
      this._current_item = cur
    }
  },
  
  /*
   *  Les trois méthodes suivantes gèrent l&#x27;utilisation des raccourcis
   *  clavier sur le div listing.
   *  
   */
  /* Sélectionne l&#x27;item suivant dans le listing */
  &quot;select_next_item&quot;:{
    get:function(){
      var obj ;
      obj = this.current_item ? this.div_current_item.next()
                              : this.div_current_listing.find(&#x27;div:first-child&#x27;)
      if(obj.length) this.current_item = this.idOf(obj)
    }
  },
  /* Sélectionne l&#x27;item précédent dans le listing */
  &quot;select_prev_item&quot;:{
    get:function(){
      var obj ;
      obj = this.current_item ? this.div_current_item.prev()
                              : this.div_current_listing.find(&#x27;div:first-child&#x27;)
      if(obj.length) this.current_item = this.idOf(obj)
    }
  },
  /* Choisit l&#x27;item courant du listing (= click sur le titre) */
  &quot;choose_current_item&quot;:{
    get:function(){
      if(this.current_item)
      {
        this.OBJS.on_choose_item(this.current_item)
      }
      else
      {
        F.show(LOCALE.film.message[&#x27;must choose a film&#x27;])
      }
    }
  },
  
  /*
   *  Passer l&#x27;item sélectionné en édition
   *  
   */
  &quot;edit_selected&quot;:{
    get:function(){
      if(!this.current_item) return F.show(LOCALE.film.message[&#x27;no item selected&#x27;]+&#x27; &#x27;+LOCALE.film.message[&#x27;choose item to edit it&#x27;])
      this.OBJS.Edition.edit(this.current_item)
    }
  },
  
  /*
   *  Détruire l&#x27;item sélectionné
   *  
   */
  &quot;remove_selected&quot;:{
    get:function(){
      if(!this.current_item) return F.show(LOCALE.film.message[&#x27;no item selected&#x27;]+&#x27; &#x27;+LOCALE.film.message[&#x27;cant remove item&#x27;])
      this.OBJS.Edition.want_remove(this.current_item)
    }
  },
  
  /*
   *  Scroll jusqu&#x27;à l&#x27;item courant (sélectionné)
   *  
   */
  &quot;scroll_to_current_item&quot;:{
    get:function(){
      if(this.current_item)
      {
        var obj = this.div_item(this.current_item)
        this.div_listing.scrollTop(obj.position().top - 50)
      }
    }
  },
  
  /*
   *  Règle les options d&#x27;affichage du titre
   *  (à la construction de la fenêtre)
   *
   *  NOTES
   *  -----
   *    = Règle aussi l&#x27;aperçu du titre
   *  
   */
  &quot;set_options&quot;:{
    get:function(){
      for(var opt in this.options_balise){
        this.set_option(opt)
      }
      this.set_apercu_balise
    }
  },
  &quot;set_option&quot;:{
    value:function(opt, value){
      if(undefined != value) this.options_balise[opt] = value
      $(&#x27;div#&#x27;+this.id_panneau+&#x27;_options input[type=&quot;checkbox&quot;]#&#x27;+this.prefix+&#x27;option-&#x27;+opt)[0].checked = this.options_balise[opt]
    }
  },
  &quot;toggle_option&quot;:{
    value:function(opt){
      this.set_option(opt, !this.options_balise[opt])
      this.set_apercu_balise
    }
  },
  
  
  /* ---------------------------------------------------------------------
   *  ACTIONS SUR ÉLÉMENTS DOM
   * --------------------------------------------------------------------- */
  
  /*
   *  Affiche/Masque le formulaire
   * 
   * 
   */
  &quot;show_formulaire&quot;:{
    get:function(){
      var id_pan = this.id_panneau
      L([&#x27;tools&#x27;, &#x27;onglets&#x27;, &#x27;listings&#x27;, &#x27;buttons&#x27;, &#x27;options&#x27;]).each(function(suf){
        $(&#x27;div#&#x27;+id_pan+&#x27;_&#x27;+suf).hide()
      })
      $(&#x27;div#&#x27;+id_pan+&#x27;_edition&#x27;).show()
    }
  },
  &quot;hide_formulaire&quot;:{
    get:function(){
      var id_pan = this.id_panneau
      $(&#x27;div#&#x27;+id_pan+&#x27;_edition&#x27;).hide()
      L([&#x27;tools&#x27;, &#x27;onglets&#x27;, &#x27;listings&#x27;, &#x27;buttons&#x27;, &#x27;options&#x27;]).each(function(suf){
        $(&#x27;div#&#x27;+id_pan+&#x27;_&#x27;+suf).show()
      })
    }
  },
  
  /* ---------------------------------------------------------------------
   *
   *  CONSTRUCTEURS
   *
   */
  
  /*
   *  Préparation du panneau des films (rendu draggable)
   *  
   */
  &quot;prepare_panneau&quot;:{
    get:function(){
      $(&#x27;body&#x27;).append( this.html_main_panneau )
      // Définition du focus
      var idfocus, obj ;
      for(idfocus in this.DFOCUS)
      {
        obj = this.DFOCUS[idfocus].obj = this[&#x27;div_&#x27;+idfocus]
        obj.bind(&#x27;keypress&#x27;, $.proxy(this[&#x27;keypress_on_&#x27;+idfocus], this))
        // obj.bind(&#x27;click&#x27;, $.proxy(this.set_focus_on, this, idfocus))
      }
      // Observers
      this.panneau.draggable({containment:&#x27;parent&#x27;})
      // On coche les options par défaut
      this.set_options
      this.main_panneau_ready = true
    }
  },
  
 
  /*
   *  Fabrication de la liste des films
   *  
   *  NOTES
   *  -----
   *    ::  On ne fabrique que le &quot;gabarit&quot; avec les onglets
   *        C&#x27;est seulement le click sur un onglet qui déterminera l&#x27;affichage
   *        de la liste.
   */
  &quot;html_main_panneau&quot;:{
    get:function(){
      return  &#x27;&lt;panneau id=&quot;&#x27;+this.id_panneau+&#x27;&quot; class=&quot;main_panneau_items&quot;&gt;&#x27; +
                this.html_div_outils  +
                this.html_div_edition +
                this.html_div_onglets +
                &#x27;&lt;div id=&quot;&#x27;+this.id_panneau+&#x27;_listings&quot; class=&quot;focusable main_panneau_listings&quot; tabindex=&quot;1&quot;&gt;&lt;/div&gt;&#x27; +
                this.html_div_options +
                this.html_div_boutons +
              &#x27;&lt;/panneau&gt;&#x27;
    }
  },
  /*
   *  Construit et retourne le DIV des options
   *  
   */
  &quot;html_div_options&quot;:{
    get:function(){
      var cbs = &quot;&quot;, id, opt ;
      this.options_balise = {}
      for(opt in this.OBJS.OPTIONS)
      {
        this.options_balise[opt] = this.OBJS.OPTIONS[opt].valdef
        id   = this.prefix+&quot;option-&quot;+opt
        cbs += &#x27;&lt;input type=&quot;checkbox&quot; id=&quot;&#x27;+id+&#x27;&quot; &#x27; +
                &#x27;onchange=&quot;$.proxy(&#x27;+this.NAME+&#x27;.onchange_option, &#x27;+this.NAME+&#x27;, this)()&quot; /&gt;&#x27; +
                &#x27;&lt;label for=&quot;&#x27;+id+&#x27;&quot;&gt;&#x27;+ this.OBJS.OPTIONS[opt].hname +&#x27;&lt;/label&gt;&#x27; ;
      }
      var aspect_titre = &#x27;&lt;span id=&quot;&#x27;+this.prefix+&#x27;aspect_balise&quot; class=&quot;item_aspect_balise&quot;&gt;Titre original&lt;/span&gt;&#x27;
      return &#x27;&lt;div id=&quot;&#x27;+this.id_panneau+&#x27;_options&quot; class=&quot;focusable main_panneau_options&quot; tabindex=&quot;2&quot;&gt;&#x27; + aspect_titre + cbs + &#x27;&lt;/div&gt;&#x27;
    }  
  },
  

  /*
   *  Construit le div des onglets lettre
   *  
   */
  &quot;html_div_onglets&quot;:{
    get:function(){
      var c = &#x27;&lt;div id=&quot;&#x27;+this.id_panneau+&#x27;_onglets&quot; class=&quot;focusable main_panneau_onglets&quot; tabindex=&quot;0&quot;&gt;&#x27;
      // Seulement pour FILMS
      if(this.NAME ==  &#x27;FILMS.Dom&#x27;) c += this.div_onglet( 0, &#x27;0-9&#x27; )
      for(var i = 65; i&lt;=90; ++i){
        c += this.div_onglet( i, String.fromCharCode(i) )
      }
      c += &#x27;&lt;/div&gt;&#x27;
      return c
    }
  },
  /* Retourne le code HTML pour un onglet de code +ascii+ et de titre +letter+ */
  &quot;div_onglet&quot;:{
    value:function(ascii, letter){
      return &#x27;&lt;div id=&quot;&#x27;+this.prefix+&#x27;onglet_letter-&#x27;+ascii+
      &#x27;&quot; class=&quot;onglet_letter&quot; onclick=&quot;$.proxy(&#x27;+this.NAME+&#x27;.on_click_onglet, &#x27;+this.NAME+&#x27;, &#x27;+
      ascii+&#x27;)()&quot;&gt;&#x27;+letter+&#x27;&lt;/div&gt;&#x27;
    }
  },
  
  /*
   *  Construit le div des outils du panneau
   *  
   */
  &quot;html_div_outils&quot;:{
    get:function(){
      return &#x27;&lt;div id=&quot;&#x27;+this.id_panneau+&#x27;_tools&quot;&gt;&#x27; + &#x27;&lt;/div&gt;&#x27;
    }
  },
  /*
   *  Construit le div du formulaire de film
   *  
   */
  &quot;html_div_edition&quot;:{
    get:function(){
      return &#x27;&lt;div id=&quot;&#x27;+this.id_panneau+&#x27;_edition&quot;&gt;&#x27; + &#x27;&lt;/div&gt;&#x27;
    }
  },
  /*
   *  Code HTML du div des boutons (bas)
   *  
   */
  &quot;html_div_boutons&quot;:{
    get:function(){
      return &#x27;&lt;div id=&quot;&#x27;+this.id_panneau+&#x27;_buttons&quot; class=&quot;buttons&quot;&gt;&#x27; +
      &#x27;&lt;input type=&quot;button&quot; value=&quot;Renoncer&quot; onclick=&quot;$.proxy(&#x27;+this.NAME+&#x27;.hide_panneau, &#x27;+this.NAME+&#x27;)()&quot; class=&quot;fleft&quot; /&gt;&#x27; +
      &#x27;&lt;input type=&quot;button&quot; value=&quot;+&quot; onclick=&quot;$.proxy(&#x27;+this.parent_as_string+&#x27;.Edition.edit, &#x27;+this.parent_as_string+&#x27;.Edition)()&quot; /&gt;&#x27; +
      &#x27;&lt;/div&gt;&#x27;
    }
  }
  
}
/* /OBJETS_Dom_defined_properties */

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
